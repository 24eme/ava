<?php use_javascript("drev.js", "last") ?>

<?php include_partial('drev/breadcrumb', array('drev' => $drev )); ?>

<?php include_partial('drev/step', array('step' => 'exploitation', 'drev' => $drev)) ?>
<div class="page-header">
    <h2>Entreprise <small>Données administratives, merci de les modifier en cas de changement</small></h2>
</div>

<form action="<?php echo url_for("drev_exploitation", $drev) ?>" method="post" class="form-horizontal ajaxForm">
    <?php include_partial('etablissement/form', array('form' => $form, 'etablissement' => $etablissement)); ?>

    <?php if(isset($form['chais_adresse'])): ?>
    <h3>Logement du vin <small><a href="#" class="btn_exploitation_modifier">(éditer)</a></small></h3>
    <div class="row row-margin" style="margin-bottom: 20px;">
        <div class="row_info_exploitation col-xs-12 <?php if($form->isBound()): ?>hidden<?php endif; ?>">
            <div class="col-xs-12 <?php if($form['chais_nom']->getValue() || $form['chais_adresse']->getValue() || $form['chais_commune']->getValue() || $form['chais_code_postal']->getValue()): ?>hidden<?php endif; ?>">
                <div class="form-group">
                    <p class="form-control-static">Le vin est logé à la même adresse que l'entreprise</p>
                </div>
            </div>
            <div class="col-xs-7 col-xs-offset-5 <?php if(!$form['chais_nom']->getValue() && !$form['chais_adresse']->getValue() && !$form['chais_commune']->getValue() && !$form['chais_code_postal']->getValue()): ?>hidden<?php endif; ?>">
                <div class="form-group">
                    <?php echo $form["chais_nom"]->renderLabel(null, array("class" => "col-xs-4 control-label")); ?>
                    <div class="col-xs-8">
                        <p class="form-control-static"><?php echo $form['chais_nom']->getValue() ?></p>
                    </div>
                </div>
                <div class="form-group">
                    <?php echo $form["chais_adresse"]->renderLabel(null, array("class" => "col-xs-4 control-label")); ?>
                    <div class="col-xs-8">
                        <p class="form-control-static"><?php echo $form['chais_adresse']->getValue() ?></p>
                    </div>
                </div>
                <div class="form-group">
                    <?php echo $form["chais_commune"]->renderLabel(null, array("class" => "col-xs-4 control-label")); ?>
                    <div class="col-xs-8">
                        <p class="form-control-static"><?php echo $form['chais_commune']->getValue() ?></p>
                    </div>
                </div>
                <div class="form-group">
                    <?php echo $form["chais_code_postal"]->renderLabel(null, array("class" => "col-xs-4 control-label")); ?>
                    <div class="col-xs-8">
                        <p class="form-control-static"><?php echo $form['chais_code_postal']->getValue() ?></p>
                    </div>
                </div>
                <div class="form-group">
                    <?php echo $form["chais_telephone"]->renderLabel(null, array("class" => "col-xs-4 control-label")); ?>
                    <div class="col-xs-8">
                        <p class="form-control-static"><?php echo $form['chais_telephone']->getValue() ?></p>
                    </div>
                </div>
            </div>
        </div>
        <div class="row_form_exploitation <?php if(!$form->isBound()): ?>hidden<?php endif; ?>">
            <div class="col-xs-12">
                <div class="col-xs-12">
                    <div class="form-group">
                        <div class="checkbox">
                            <label>
                                <input id="checkbox_logement_vin" type="checkbox" <?php if(!$form['chais_nom']->getValue() && !$form['chais_adresse']->getValue() && !$form['chais_commune']->getValue() && !$form['chais_code_postal']->getValue()): ?>checked="checked"<?php endif; ?> value="" class="checkbox-relation" data-relation="#form_logement_vin">
                                Le vin est logé à la même adresse que l'entreprise
                            </label>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-xs-12 <?php if(!$form['chais_nom']->getValue() && !$form['chais_adresse']->getValue() && !$form['chais_commune']->getValue() && !$form['chais_code_postal']->getValue()): ?>hidden<?php endif; ?>" id="form_logement_vin">
                <div class="col-xs-7 col-xs-offset-5">
                <div class="form-group">
                    <?php echo $form["chais_nom"]->renderError(); ?>
                    <?php echo $form["chais_nom"]->renderLabel(null, array("class" => "col-xs-4 control-label")); ?>
                    <div class="col-xs-8">
                        <?php echo $form["chais_nom"]->render(array("class" => "form-control")); ?>
                    </div>
                </div>
                <div class="form-group">
                    <?php echo $form["chais_adresse"]->renderError(); ?>
                    <?php echo $form["chais_adresse"]->renderLabel(null, array("class" => "col-xs-4 control-label")); ?>
                    <div class="col-xs-8">
                        <?php echo $form["chais_adresse"]->render(array("class" => "form-control")); ?>
                    </div>
                </div>
                <div class="form-group">
                    <?php echo $form["chais_code_postal"]->renderError(); ?>
                    <?php echo $form["chais_code_postal"]->renderLabel(null, array("class" => "col-xs-4 control-label")); ?>
                    <div class="col-xs-8">
                        <?php echo $form["chais_code_postal"]->render(array("class" => "form-control")); ?>
                    </div>
                </div>
                <div class="form-group">
                    <?php echo $form["chais_commune"]->renderError(); ?>
                    <?php echo $form["chais_commune"]->renderLabel(null, array("class" => "col-xs-4 control-label")); ?>
                    <div class="col-xs-8">
                        <?php echo $form["chais_commune"]->render(array("class" => "form-control")); ?>
                    </div>
                </div>
                <div class="form-group">
                    <?php echo $form["chais_telephone"]->renderError(); ?>
                    <?php echo $form["chais_telephone"]->renderLabel(null, array("class" => "col-xs-4 control-label")); ?>
                    <div class="col-xs-8">
                        <?php echo $form["chais_telephone"]->render(array("class" => "form-control")); ?>
                    </div>
                </div>
            </div>
            </div>
        </div>
    </div>
    <?php endif; ?>
    <?php if(DrevConfiguration::getInstance()->hasDenominationAuto()) : ?>
        <div class="row row-margin">
            <div class="col-xs-12">
                <a href="#" data-toggle="modal" data-target="#drevDenominationAuto" class="pull-right">Changer les certifications que je déclare</a>
                <br/><br/>
            </div>
        </div>
    <?php endif; ?>

    <?php if(!DrevConfiguration::getInstance()->isDrDouaneRequired()): ?>
    <div class="row" style="margin-bottom: 20px; margin-top: -20px;">
        <div class="col-xs-12">
            <div class="checkbox pull-right">
                <label>
                    <?php
                        $checked = 'checked="checked"';
                        if (date('Ymd') < DrevConfiguration::getInstance()->getDateBeginDouane(intval($drev->campagne))) {
                            $checked = 'readonly disabled';
                        }
                    ?>
                  <input type="checkbox" id="import_dr_prodouane_checkbox" name="import_dr_prodouane" value="1" <?php echo $checked; ?>> Récupérer ma déclaration de récolte depuis prodouane
                </label>
            </div>
        </div>
    </div>
    <?php endif; ?>

    <div class="row row-margin row-button">
        <div class="col-xs-4"><a href="<?php echo url_for("declaration_etablissement", array('identifiant' => $etablissement->identifiant, 'campagne' => $drev->campagne)); ?>" class="btn btn-default btn-upper"><span class="glyphicon glyphicon-chevron-left"></span> Retourner à mon espace</a></div>
        <div class="col-xs-4 text-center">
            <a href="" id="btn_exploitation_annuler" class="btn btn-danger hidden">Annuler</a>
            <button id="btn_exploitation_modifier" type="button" class="btn btn-default btn_exploitation_modifier">Modifier</button>
        </div>
        <div class="col-xs-4 text-right"><button type="submit" class="btn btn-primary btn-upper">Valider et continuer <span class="glyphicon glyphicon-chevron-right"></span></button></div>
    </div>
</form>
<?php if(DrevConfiguration::getInstance()->hasDenominationAuto()) : ?>
    <?php include_partial('drev/popupDenominationAutoForm', array('url' => url_for('drev_denomination_auto', $drev), 'form' => $denominationAutoForm, 'drev' => $drev)
        ); ?>
<?php endif; ?>
